//! malette.js
//! version : 0.01
//! author : Brendan Heberton
//!license : MIT 
!function(t){"use strict";var e=function(t,e){console.log("init Malette, options: ",e),this.options=e,this.width=e.width||239,this.height=e.height||"auto",this.container=t,this._handlers={},this.layer=e.layer||null,this.format=e.formatIn||"esri-json",this.exportFormat=e.formatOut||"esri-json","esri-json"===this.format?e.style&&(this.style=e.style||{},this.fillOpacity=this.style.symbol.color[3],this.style.symbol.color=this._dojoColorToRgba(this.style.symbol.color),this.style.symbol.outline.color=this._dojoColorToRgba(this.style.symbol.outline.color)):e.style&&this._toEsriJson(),this._buildUI(),console.log("opts",e),e.exportStyle===!0&&this._addExporter()};e.prototype._buildUI=function(){var t=document.getElementById(this.container),e=document.createElement("div");t.appendChild(e).id="malette";var o=document.createElement("div");e.appendChild(o).id="malette-content";var l=document.createElement("div");e.appendChild(l).id="malette-header",l.innerHTML="Malette",this._addTabs(e),this._constructColorRegion(o)},e.prototype._addTabs=function(t){var e=this,o=document.createElement("div");t.appendChild(o).id="malette-tab-region",this._createElement("div",o,"malette-color-tab","color","malette-tab malette-tab-selected"),this._createElement("div",o,"malette-size-tab","size","malette-tab"),this._createElement("div",o,"malette-stroke-tab","stroke","malette-tab"),this._createElement("div",o,"malette-opacity-tab","opacity","malette-tab");for(var l=document.getElementsByClassName("malette-tab"),i=0;i<l.length;i++)l[i].addEventListener?l[i].addEventListener("click",function(t){e._onTabClick.call(e,t)}):l[i].attachEvent("onclick",function(t){e._onTabClick.call(e,t)})},e.prototype._addExporter=function(){var t=document.getElementById("malette-header"),e=this._createElement("div",t,"malette-export-toggle-container","Export style",""),o=this._createElement("input",e,"malette-export-toggle","","");o.type="checkbox"},e.prototype._addColors=function(t,e){var o,l=["rgb(255,255,255)","rgb(240,240,240)","rgb(217,217,217)","rgb(189,189,189)","rgb(150,150,150)","rgb(115,115,115)","rgb(82,82,82)","rgb(37,37,37)","rgb(247,252,253)","rgb(224,236,244)","rgb(191,211,230)","rgb(158,188,218)","rgb(140,150,198)","rgb(140,107,177)","rgb(136,65,157)","rgb(110,1,107)","rgb(255,247,243)","rgb(253,224,221)","rgb(252,197,192)","rgb(250,159,181)","rgb(247,104,161)","rgb(221,52,151)","rgb(174,1,126)","rgb(122,1,119)","rgb(255,255,204)","rgb(255,237,160)","rgb(254,217,118)","rgb(254,178,76)","rgb(253,141,60)","rgb(252,78,42)","rgb(227,26,28)","rgb(177,0,38)","rgb(255,255,217)","rgb(237,248,177)","rgb(199,233,180)","rgb(127,205,187)","rgb(65,182,196)","rgb(29,145,192)","rgb(34,94,168)","rgb(12,44,132)","rgb(247,252,240)","rgb(224,243,219)","rgb(204,235,197)","rgb(168,221,181)","rgb(123,204,196)","rgb(78,179,211)","rgb(43,140,190)","rgb(8,88,158)","rgb(247,252,253)","rgb(229,245,249)","rgb(204,236,230)","rgb(153,216,201)","rgb(102,194,164)","rgb(65,174,118)","rgb(35,139,69)","rgb(0,88,36)"],i=this._createElement("div",t,"malette-color-palette","",""),n=this._createElement("div",i,"malette-selected-color","Selected color","");o=this._createElement("span",n,"malette-selected-swatch","","malette-color-swatch-selected"),o.style.backgroundColor=e,l.forEach(function(t,e){o=document.createElement("div"),o.style.backgroundColor=t,i.appendChild(o).className="malette-color-swatch"})},e.prototype._constructColorRegion=function(t){var e=this;t.innerHTML="",this._createElement("div",t,"malette-single-color-option","Single","malette-option-toggle malette-option-toggle-selected"),this.layer?this._createElement("div",t,"malette-theme-color-option","Theme","malette-option-toggle"):this._createElement("div",t,"malette-theme-color-option","Theme","malette-option-toggle disabled"),console.log("this.style.symbol.color",this.style.symbol.color),this._addColors(t,this.style.symbol.color);for(var o=document.getElementsByClassName("malette-color-swatch"),l=0;l<o.length;l++)o[l].addEventListener?o[l].addEventListener("click",function(t){e._onColorClick.call(e,t)}):o[l].attachEvent("onclick",function(t){e._onColorClick.call(e,t)})},e.prototype._constructSizePalette=function(t){var e=this;t.innerHTML="",this._createElement("div",t,"malette-single-size-option","Single","malette-option-toggle malette-option-toggle-selected"),this.layer?this._createElement("div",t,"malette-graduated-size-option","Graduated","malette-option-toggle"):this._createElement("div",t,"malette-graduated-size-option","Graduated","malette-option-toggle disabled");var o=this.style.symbol.size||8,l=document.createElement("input");l.type="range",l.min=1,l.max=30,l.step=1,l.value=o,t.appendChild(l).id="malette-size-slider";var i=this._createElement("div",t,"malette-size-number","Radius: "+o+"px","");t.appendChild(i);var n=document.getElementById("malette-size-slider");n.addEventListener?n.addEventListener("input",function(t){e._onSizeChanged.call(e,t)}):n.attachEvent("onchange",function(t){e._onSizeChanged.call(e,t)})},e.prototype._constructStrokePalette=function(t){var e=this;t.innerHTML="";var o=this.style.symbol.outline.width||.5,l=document.createElement("input");l.type="range",l.min=.5,l.max=20,l.step=.5,l.value=o,t.appendChild(l).id="malette-stroke-slider";var i=this._createElement("div",t,"malette-stroke-width",o+"px","");t.appendChild(i),this._addColors(t,this.style.symbol.outline.color);var n=document.getElementById("malette-stroke-slider");n.addEventListener?n.addEventListener("input",function(t){e._onStrokeWidthChanged.call(e,t)}):n.attachEvent("onchange",function(t){e._onStrokeWidthChanged.call(e,t)});for(var n=document.getElementsByClassName("malette-color-swatch"),r=0;r<n.length;r++)n[r].addEventListener?n[r].addEventListener("click",function(t){e._onStrokeColorClick.call(e,t)}):n[r].attachEvent("onclick",function(t){e._onStrokeColorClick.call(e,t)})},e.prototype._constructOpacityPalette=function(t){var e=this;t.innerHTML="";var o=this.fillOpacity/255||.7,l=document.createElement("input");l.type="range",l.min=.1,l.max=1,l.step=.1,l.value=o,t.appendChild(l).id="malette-opacity-slider";var i=this._createElement("div",t,"malette-opacity-number","Opacity: "+100*o+"%","");t.appendChild(i);var n=document.getElementById("malette-opacity-slider");n.addEventListener?n.addEventListener("input",function(t){e._onOpacityChanged.call(e,t)}):n.attachEvent("onchange",function(t){e._onOpacityChanged.call(e,t)})},e.prototype._createElement=function(t,e,o,l,i){var n=document.createElement(t);return e.appendChild(n).id=o,n.innerHTML=l,document.getElementById(o).className=i,n},e.prototype.changeTab=function(t){console.log("tab",t);var e=document.getElementById("malette-content");switch(t){case"color":this._constructColorRegion(e);break;case"size":this._constructSizePalette(e);break;case"stroke":this._constructStrokePalette(e);break;case"opacity":this._constructOpacityPalette(e);break;default:this._constructColorRegion(e)}},e.prototype.setSelectedColor=function(t){this.style.symbol.color=t;var e=document.getElementById("malette-selected-swatch");e.style.backgroundColor=this.style.symbol.color,this._updateStyle()},e.prototype.setSelectedStrokeColor=function(t){this.style.symbol.outline.color=t;var e=document.getElementById("malette-selected-swatch");e.style.backgroundColor=this.style.symbol.outline.color,this._updateStyle()},e.prototype.setSelectedSize=function(t){this.style.symbol.size=parseInt(t);var e=document.getElementById("malette-size-number");e.innerHTML="Radius: "+t+"px",this._updateStyle()},e.prototype.setStrokeWidth=function(t){this.style.symbol.outline.width=parseFloat(t);var e=document.getElementById("malette-stroke-width");e.innerHTML=t+"px",this._updateStyle()},e.prototype.setOpacity=function(t){this.fillOpacity=255*parseFloat(t);var e=document.getElementById("malette-opacity-number");e.innerHTML="Opacity: "+100*t+"%",this._updateStyle()},e.prototype._dojoColorToRgba=function(t){var e="rgba("+t[0]+","+t[1]+","+t[2]+","+t[3]+")";return e},e.prototype._rgbaToDojoColor=function(t,e){var o;if(Array.isArray(t))return o=t,o[3]=e,o;var o=t.split(",");return[parseInt(o[0].replace(/[^0-9]/g,"")),parseInt(o[1]),parseInt(o[2]),e]},e.prototype._toEsriJson=function(){"css"===this.format&&(this.style={type:"simple",symbol:{}},this.style.symbol.color=this.options.style.fillColor?this.options.style.fillColor:"rgba(202,58,45,130)",this.style.symbol.size=this.options.style.radius?this.options.style.radius:8,this.style.symbol.outline={},this.style.symbol.outline.width=this.options.style.weight||1,this.style.symbol.outline.color=[this.options.style.color]||"rgba(255,255,255,255",this.fillOpacity=this.options.style.fillOpacity?255*this.options.style.fillOpacity:255)},e.prototype._toCss=function(t){var e={};e.fillColor=this.style.symbol.color,e.weight=this.style.symbol.outline.width,e.color=this.style.symbol.outline.color,e.radius=this.style.symbol.size,e.fillOpacity=this.fillOpacity/255,t(e)},e.prototype._updateStyle=function(){var t=this;"esri-json"===this.exportFormat?(console.log("this.style.symbol.color",this.style.symbol.color),console.log("fillOpacity",this.fillOpacity),this.style.symbol.color=this._rgbaToDojoColor(this.style.symbol.color,this.fillOpacity),this.style.symbol.outline.color=this._rgbaToDojoColor(this.style.symbol.outline.color),console.log("emit --->>>",this.style),this.emit("style-change",this.style)):"css"===this.exportFormat&&this._toCss(function(e){t.emit("style-change",e)})},e.prototype.on=function(t,e){this._handlers[t]=e},e.prototype.emit=function(t,e){this._handlers[t]&&this._handlers[t](e)},e.prototype._onColorClick=function(t){1!==t.which||t.metaKey||t.ctrlKey||(t.preventDefault(),this.setSelectedColor(t.target.style.backgroundColor))},e.prototype._onStrokeColorClick=function(t){1!==t.which||t.metaKey||t.ctrlKey||(t.preventDefault(),this.setSelectedStrokeColor(t.target.style.backgroundColor))},e.prototype._onSizeChanged=function(t){t.preventDefault(),this.setSelectedSize(t.target.value)},e.prototype._onStrokeWidthChanged=function(t){t.preventDefault(),this.setStrokeWidth(t.target.value)},e.prototype._onOpacityChanged=function(t){t.preventDefault(),this.setOpacity(t.target.value)},e.prototype._onTabClick=function(t){if(1===t.which&&!t.metaKey&&!t.ctrlKey){t.preventDefault();for(var e=document.getElementsByClassName("malette-tab"),o=0;o<e.length;o++)e[o].classList.remove("malette-tab-selected");t.target.classList.add("malette-tab-selected"),this.changeTab(t.target.innerHTML)}},t.Malette=e}(window);